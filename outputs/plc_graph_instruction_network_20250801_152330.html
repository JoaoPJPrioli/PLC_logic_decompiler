
<!DOCTYPE html>
<html>
<head>
    <title>PLC Instruction_Network Graph</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f8f9fa; }
        .container { max-width: 1200px; margin: 0 auto; }
        .graph-container { background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .node { cursor: pointer; }
        .node text { font-size: 11px; text-anchor: middle; pointer-events: none; }
        .link { stroke-opacity: 0.6; }
        .tooltip { position: absolute; background: rgba(0,0,0,0.8); color: white; 
                   padding: 8px; border-radius: 4px; font-size: 12px; pointer-events: none; 
                   box-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .legend { margin-top: 20px; }
        .legend-item { display: inline-block; margin-right: 20px; }
        .legend-color { width: 15px; height: 15px; display: inline-block; margin-right: 5px; }
        .stats { background: #e9ecef; padding: 15px; border-radius: 4px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h2>PLC Instruction Network Graph Visualization</h2>
        <div class="stats">
            <strong>Graph Statistics:</strong> 
            15 nodes, 10 edges
            | <strong>Graph Type:</strong> instruction_network
            | <strong>Generated:</strong> 2025-08-01 15:23:30
        </div>
        
        <div class="graph-container">
            <p>Interactive visualization showing the relationships in your PLC logic. Drag nodes to explore the structure.</p>
            <svg width="100%" height="600" id="graph"></svg>
        </div>
        
        <div class="legend">
            <h4>Legend:</h4>
            <div class="legend-item">
                <span class="legend-color" style="background: lightblue;"></span> Program/Main Component
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background: lightgreen;"></span> Routine/Function
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background: lightyellow;"></span> Rung/Logic Block
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background: lightcoral;"></span> Tag/Variable
            </div>
        </div>
    </div>
    
    <script>
        const nodes = [{"id": "INSTR_XIC", "label": "XIC (Examine Contact Open)", "type": "instruction", "color": "lightblue", "size": 35}, {"id": "INSTR_XIO", "label": "XIO (Examine Contact Closed)", "type": "instruction", "color": "lightblue", "size": 30}, {"id": "INSTR_OTE", "label": "OTE (Output Energize)", "type": "instruction", "color": "lightgreen", "size": 40}, {"id": "INSTR_OTL", "label": "OTL (Output Latch)", "type": "instruction", "color": "lightgreen", "size": 25}, {"id": "INSTR_OTU", "label": "OTU (Output Unlatch)", "type": "instruction", "color": "lightgreen", "size": 25}, {"id": "INSTR_TON", "label": "TON (Timer On Delay)", "type": "instruction", "color": "yellow", "size": 30}, {"id": "INSTR_TOF", "label": "TOF (Timer Off Delay)", "type": "instruction", "color": "yellow", "size": 25}, {"id": "INSTR_CTU", "label": "CTU (Count Up)", "type": "instruction", "color": "orange", "size": 28}, {"id": "INSTR_CTD", "label": "CTD (Count Down)", "type": "instruction", "color": "orange", "size": 25}, {"id": "INSTR_MOV", "label": "MOV (Move Data)", "type": "instruction", "color": "lightgray", "size": 22}, {"id": "INSTR_EQU", "label": "EQU (Equal Compare)", "type": "instruction", "color": "lightpink", "size": 20}, {"id": "INSTR_GEQ", "label": "GEQ (Greater Equal)", "type": "instruction", "color": "lightpink", "size": 18}, {"id": "INSTR_JSR", "label": "JSR (Jump to Subroutine)", "type": "instruction", "color": "red", "size": 25}, {"id": "INSTR_JMP", "label": "JMP (Jump)", "type": "instruction", "color": "red", "size": 20}, {"id": "INSTR_LBL", "label": "LBL (Label)", "type": "instruction", "color": "red", "size": 15}];
        const links = [{"source": "INSTR_XIC", "target": "INSTR_OTE", "type": "sequence", "color": "gray", "weight": 3}, {"source": "INSTR_XIO", "target": "INSTR_OTE", "type": "sequence", "color": "gray", "weight": 2}, {"source": "INSTR_TON", "target": "INSTR_OTE", "type": "timer_output", "color": "blue", "weight": 2}, {"source": "INSTR_CTU", "target": "INSTR_OTE", "type": "counter_output", "color": "orange", "weight": 2}, {"source": "INSTR_EQU", "target": "INSTR_OTE", "type": "compare_output", "color": "purple", "weight": 1}, {"source": "INSTR_MOV", "target": "INSTR_EQU", "type": "data_flow", "color": "green", "weight": 1}, {"source": "INSTR_JSR", "target": "INSTR_LBL", "type": "jump", "color": "red", "weight": 1}, {"source": "INSTR_JMP", "target": "INSTR_LBL", "type": "jump", "color": "red", "weight": 1}, {"source": "INSTR_XIC", "target": "INSTR_OTL", "type": "latch_control", "color": "darkgreen", "weight": 1}, {"source": "INSTR_XIC", "target": "INSTR_OTU", "type": "unlatch_control", "color": "darkred", "weight": 1}];
        
        const svg = d3.select("#graph");
        const containerWidth = document.querySelector('.graph-container').offsetWidth - 40;
        const width = containerWidth;
        const height = 600;
        
        svg.attr("width", width).attr("height", height);
        
        const simulation = d3.forceSimulation(nodes)
            .force("link", d3.forceLink(links).id(d => d.id).distance(150))
            .force("charge", d3.forceManyBody().strength(-400))
            .force("center", d3.forceCenter(width / 2, height / 2))
            .force("collision", d3.forceCollide().radius(d => (d.size || 20) / 2 + 5));
        
        const link = svg.append("g")
            .selectAll("line")
            .data(links)
            .join("line")
            .attr("class", "link")
            .style("stroke", d => d.color || "#999")
            .style("stroke-width", d => Math.sqrt(d.weight || 1) * 2);
        
        const node = svg.append("g")
            .selectAll("g")
            .data(nodes)
            .join("g")
            .attr("class", "node")
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended));
        
        node.append("circle")
            .attr("r", d => (d.size || 20) / 2)
            .style("fill", d => d.color || "#69b3a2")
            .style("stroke", "#333")
            .style("stroke-width", 1.5);
        
        node.append("text")
            .text(d => d.label || d.id)
            .attr("dy", 4)
            .style("font-size", "10px");
        
        // Tooltip
        const tooltip = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);
        
        node.on("mouseover", function(event, d) {
            tooltip.transition().duration(200).style("opacity", .9);
            tooltip.html(`<strong>${d.label || d.id}</strong><br/>
                         Type: ${d.type || 'Unknown'}<br/>
                         ID: ${d.id}<br/>
                         Size: ${d.size || 20}`)
                .style("left", (event.pageX + 10) + "px")
                .style("top", (event.pageY - 28) + "px");
        })
        .on("mouseout", function(d) {
            tooltip.transition().duration(500).style("opacity", 0);
        });
        
        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);
            
            node.attr("transform", d => `translate(${d.x},${d.y})`);
        });
        
        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }
        
        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }
        
        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }
    </script>
</body>
</html>
            